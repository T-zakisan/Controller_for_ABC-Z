# Controller for ABC-Z
定評のあるインターフェースを使って、採点ソフトABC-Zを使用することで、更に採点業務が快適に！！

一括機能やフィルター機能をマウスに持ち直すことなく操作可能。

そのため、目線がモニタから離れることがないため、操作効率が高まります。

※フィルター機能は、ボタンが特に小さく押しにくい！

※フィルター機能は、問題移動（次/前の問題）しても維持される（採点ミス確認時に重宝）

https://user-images.githubusercontent.com/43605763/186742775-77fb4bad-561c-4811-a063-ccfca45388b2.mp4



# 準備
## **Seeed XIAO PR2040** を入手
以下の販売店等から入手しておくこと！
- [SWITCHSCIENCE](https://www.switch-science.com/catalog/7634/)
- [秋月電子通称](https://akizukidenshi.com/catalog/g/gM-17044/)
- [マルツオンライン](https://www.marutsu.co.jp/pc/i/2229736/)
また、USB-Cケーブル（50cm以上はほしい）も準備しておく。



## コントローラの入手
コントローラの種類（正しくは型番）によって、対応する専用基板が異なる。

ただし専用基板は、プレステ１，２（一部）に対応している（詳細は、下記の[既知の対象コントローラ](#既知の対象コントローラ)参照）。

そのため、事前にどのコントローラをベースにするか想定をしておくことを勧める。

プレステのコントローラであっても必ずしも専用基板を作製しなくても良い（作製数が少ない場合など）

大雑把であるが、以下にまとめておく。

その他（他社含む）の場合あるいは、専用基板を使用しない場合には、電子工作の知識と作業が多くなる。


|  | ＰＳアナログなし | ＰＳアナログあり | その他（他社含む） |
|:---:|:---:|:---:|:---:|
| 型番 | SCPH-1000番系 | SCPH-1200番系※1 |  |
| 専用基板 | あり | 一部あり | なし |
| ガーバーファイル名 | SCPH_1000_PCB.zip | SCPH_1200_PCB.zip | なし |
| 拡張性※2 | △ | ◯※3 |  |

※1 SCPH-1150は、アナログ入力があるためSCPH-1200番系に含むことする

※2 ハードウェア的な縛り

※3 アナログなしよりも２ボタン多く割り当て可能


### 専用基板を作製しない場合
1. コントローラを分解し、シェル（樹脂）や各種ボタン、導電性ゴムを洗浄（温水＋中性洗剤が効果的）
2. コントローラのシェル、基板、**Seeed XIAO PR2040**が干渉しないことを確認（不要な素子、樹脂は除去）
3. 使用する各ボタン, Vcc, GND に対応するランドにジャンパー線をはんだ付け（配線を被覆しても良い）
4. **Seeed XIAO PR2040**を基板に貼り付る（シリコン系接着剤など絶縁材料であること）
5. 上記ジャンパー線を**Seeed XIAO PR2040**のGPIO, 3V, GNDへはんだ付け（GPIOの対応は適当でok）
6. コントローラを組み立てる

セガ・サターンのコントローラーの例
![PXL_20220622_165920347](https://github.com/T-zakisan/Controller_for_ABC-Z/assets/43605763/ec6456ea-1ec5-4f08-9ea6-38ee957340d6)
![PXL_20220622_165934292 MP](https://github.com/T-zakisan/Controller_for_ABC-Z/assets/43605763/32c1b979-5ce8-4f28-a526-d1d63931b0a3)

プレステ１のコントローラーの例
![PXL_20220704_145912590](https://github.com/T-zakisan/Controller_for_ABC-Z/assets/43605763/766cef57-1d51-4da4-b729-96ae99cb2e2c)
![PXL_20220704_145759181](https://github.com/T-zakisan/Controller_for_ABC-Z/assets/43605763/7b023b1e-045c-4aa3-9f04-00854a3060f3)



### 専用基板を作製する場合（ＰＳ１コントローラの場合）
1. 入手したコントローラに対応したガーバーファイル（**SCPH_1000_PCB.zip**あるいは**SCPH_1200_PCB.zip**）をDL
2. JLCPCBなどで、上記**SCPH_1000_PCB.zip**をアップロードし基板を作製
3. コントローラを分解し、基板からＬＲボタンをケーブルごと（基板両端下部の各３個所ずつ）取り外す
4. コントローラに専用基板で仮組みし、裏表の向きを確認（GNDのランド形状に注目）すると共に、干渉する樹脂をニッパやヤスリで除去
5. シェルや各種ボタン、導電性ゴムを洗浄（温水＋中性洗剤が効果的）
6. **Seeed XIAO PR2040**をピンヘッダを用いて、専用基板にはんだ付け
7. 上記3で取り外したＬＲボタンのケーブルを専用基板にはんだ付け（向きなし：ソフトウェアで補正）
8. コントローラを組み立てる


専用基板と**Seeed XIAO PR2040**の向き
![PXL_20221117_034344226](https://github.com/T-zakisan/Controller_for_ABC-Z/assets/43605763/8269d7d9-e5fc-4ade-9611-7d85e23dc93e)



※ＰＳ２の場合
上記の工程以外に以下の工程が必要となる。
ただし、ＰＳ２（アナログ入力あり）は、製造した国によって基板が異なるだけでなく、端子の配列も異なるためジャンパー線での配線で注意が必要。

1. 入手したコントローラの背面に記載されている型番（SCPH-1200 X：X=H,A,Mのいずれか）を確認（Xが重要！）
2. アナログ入力基板のリボンケーブルのはんだを除去（引っ張るとランドが剥がれるため、丁寧に！）
3. 取り外したリボンケーブルのランド部分の両端に1と8の表示（端子番号）があることを確認
4. 専用基板の左側に各コントローラと専用基板の接続対応表（下図、下表参照）通りにジャンパー線（50mmほど）で配線

![スクリーンショット 2024-01-15 025329](https://github.com/T-zakisan/Controller_for_ABC-Z/assets/43605763/d0ad38fb-8f84-4197-8656-66f134933073)


例）1200**H**の場合
| **Seeed XIAO PR2040** | 専用基板上のシルク（表示） | アナログ入力の端子番号 |
|:---:|:---:|:---:|
| GND | a | 1 |
| 3V  | b | 3 |
| X   | c | 7 |
| Y   | d | 8 |



## ファームウェアを入手とインストール
 [本家WebSiteの説明](https://wiki.seeedstudio.com/XIAO-RP2040-with-CircuitPython/)
- ファームウェア(.uf2)は、[CircuitPython本家](https://circuitpython.org/board/seeeduino_xiao_rp2040/)から入手
- 上記説明サイトの"LED Flash Tutorial"以降は不要
- PC上で、Seeed XIAO PR2040 が "CIRCUITPY"と表示されたらok


![image](https://user-images.githubusercontent.com/43605763/208617930-e2527756-ff21-485f-a371-8c3d41a6aba6.png)



## ライブラリの入手とインストール　
1. [CircuitPython本家のライブラリ配布場所](https://circuitpython.org/libraries)アクセスし、下図からライブラリをダウンロード

![image](https://user-images.githubusercontent.com/43605763/185802350-7a6c4999-844f-4b76-9860-59f934375b84.png)

2. ダウンロードしたライブラリを解凍

下図のディレクトリとファイルが生成される。

![image](https://user-images.githubusercontent.com/43605763/185802707-b66e42cc-9f02-4a70-8974-5c61c6941ead.png)

3. パソコンにSeeed XAIO PR2040 を接続（***CIRCUITPY***が出現）し、直下に***lib***を作成（***CIRCUITPY/lib***）

4. 解凍した ***/lib*** から以下のディレクトリとファイルをSeeed XAIO PR2040（***CIRCUITPY/lib***）に貼り付け
  ※adafruit_hid はディレクトリ丸ごと
 
![image](https://user-images.githubusercontent.com/43605763/185802888-962c7d67-b286-45b4-8abc-6b16a9cc2b04.png)



# ソースコードの入手とインストール
## 入手
1. 上記の***Code▼*** をクリック
2. ***Download ZIP*** をクリック

![image](https://user-images.githubusercontent.com/43605763/186346284-155919a4-edf8-4373-bf9f-97778d5a4871.png)

3. ダウンロードしたzipファイルを解凍


## インストール
以下、コントローラが ***アナログなし*** であることを想定して説明する。


### 設定ファイル用のソースコード書き込み

**ソースコードの入手とインストール** で解凍したディレクトリ内の`アナログなし_初期設定/` の



- **code.py**
- **CodeTable.txt**
 
を`CIRCUITPY`にドラッグ＆ドロップする


### 設定ファイル出力
各ボタンとSeeed XIAO RP2040 の端子の接続関係をテキスト出力し、初期設定ファイル（CodeTable.txt）を完成させる。

ボタンと端子間の接続の個体差をこの設定ファイルで吸収できる。

また、簡易的であるが動作確認にもなる。


1. **CodeTable.txt** をメモ帳で開く
2. カーソルを **,(カンマ)** の右側に移動
3. 表記通りのボタンを押して、数字が入力されていることを確認
4. 上書き保存して、終了

※もし数字が出力されなければ、物理的あるいは電気的な接続不良を疑う

![image](https://user-images.githubusercontent.com/43605763/191004226-fe6582ee-8994-4adc-a3c8-10d8aae47128.png)




### 採点用ソースコードの書き込み
**ソースコードの入手とインストール** で解凍したディレクトリ内の `アナログなし_採点/` の
- **code.py**
 
を`CIRCUITPY`にドラッグ＆ドロップする



# 既知の対象コントローラ
プレステにこだわっているわけではないが、
- 安定した持ちやすさ（30年間基本形状に変更がない理由とは）
- ボタンの表記（慣れたらなんでもよいかもしれないが、、、）
- 初期型を今でも使える品質の良さ
- 歴史がタマ数と相関がある

などからここではPSシリーズを記載。


下表の型番は下図左下、可能/不可能の文字は、下図右型の刻印を示す。

![image](https://user-images.githubusercontent.com/43605763/208640654-2430f79a-6930-4b08-bae1-1c9bb8c2eebc.png)


|  | 型番 | 可能 | 不可 | 備考 |
|:---:|:---:|:---|:---|:---|
| アナログなし | SCPH-1010 | 無印, A, H, M, F | ? | いわゆるPS1 |
| ↑ | SCPH-1080 | 無印, A, H, M | ？ | ↑ |
| ↑ | SCPH-1000R | △ | ？ | 時間を要する |
| アナログ | SCPH-1150 | A | ？ | 別刻印については不明 |
| DUALSHOCK | SCPH-1200 | 無印, A, H | M | --- |
| DUALSHOCK2 | SCPH-10010 | なし | 全て | --- |
| ↑ | DESR-10 | ？ | ？ | --- |
| DUALSHOCK3 | CECH-ZC2J | 可能性あり | ？ | 基板構想中 |
| SIXAXIS| CECH-ZC1J | なし | 全て | --- |
| DUALSHOCK4 | CUH-ZCT1J | ？ | ？ | --- |
| ↑ | CUH-ZCT2J | ？ | ？ | --- |
| DualSense | CFI-ZCT1J | ？ | ？ | --- |


以上


